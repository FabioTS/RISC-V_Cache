# This is a simple binary search algorithm developed with RISC-V Assembly code for RV32I
# Code created by FabioTS - https://github.com/FabioTS

### INPUT:
# First set target value at .data section to be found
# Set the array size desired, remember that the index begin at [0]
# Insert the elements of array in ascending order

### OUTPUT:
# Register x20 = Index of target located inside array
# Register x21 = Absolute address of located target
# Register x22 = Data value at located address
# Register x23 = Number of iterations taken to find target

.data
target:		.word 77086295
#arr_size:	.word 30	# First index is 0 arr_size would be n_elements - 1
#arr:		.word 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181, 6765, 10946, 17711, 28657, 46368, 75025, 121393, 196418, 317811, 514229, 832040, 1346269, 2178309

arr_size:	.word 1000
arr:		.word 403414, 503956, 528092, 665754, 794604, 895927, 921857, 1028615, 1177292, 1179830, 1189074, 1245768, 1290894, 1306444, 1443950, 1450968, 1496158, 1608134, 1615791, 1800450, 1873967, 1921642, 2055203, 2391222, 2491620, 2641529, 2674870, 2833540, 2900843, 2944749, 3029883, 3046979, 3158447, 3160253, 3175670, 3236960, 3258583, 3287764, 3372790, 3551980, 3556246, 3603770, 3623258, 3754626, 3815079, 3839557, 3940084, 4079845, 4135847, 4216617, 4258598, 4384747, 4409637, 4435722, 4467832, 4470386, 4535417, 4583710, 4722053, 4785971, 4863154, 4897201, 4924471, 5216131, 5498233, 5539167, 5567856, 5701682, 5773961, 5799844, 5917946, 5964272, 6098894, 6264140, 6357174, 6549091, 6582464, 6755878, 6900774, 6996533, 7033545, 7085090, 7278159, 7310956, 7371896, 7434202, 7515834, 7625104, 7702989, 7835161, 7853794, 8054568, 8076255, 8096230, 8674881, 8701371, 8749205, 8750089, 8940697, 8945675, 9209479, 9254850, 9430250, 9578211, 9641694, 9835258, 9910992, 10016301, 10141418, 10194534, 10214725, 10237720, 10318728, 10331841, 10470608, 10569942, 10590872, 10868570, 10896496, 10989692, 11213235, 11304959, 11355061, 11613186, 11646530, 11688468, 12124404, 12142202, 12232254, 12332796, 12386471, 12428778, 12575481, 12660952, 12698934, 12765287, 12959643, 13009051, 13044517, 13061927, 13105704, 13193078, 13193396, 13316789, 13534925, 13987936, 13997543, 14028008, 14047431, 14137892, 14160635, 14207796, 14208184, 14303247, 14307286, 14323062, 14352917, 14463384, 14483642, 14646662, 14827071, 14883572, 14926631, 15011845, 15029319, 15053862, 15067078, 15124684, 15222838, 15422053, 15580969, 15629159, 15843516, 15847931, 15892083, 16064528, 16295756, 16342295, 16444163, 16526846, 16715796, 16741251, 16893062, 17357199, 17519336, 17528641, 17600045, 17866398, 17882737, 17890109, 17996920, 18111879, 18204439, 18400260, 18439423, 18494174, 18501806, 18565113, 18731257, 18772687, 18974496, 19328215, 19342176, 19498783, 19543328, 19650054, 19771136, 19887523, 19916788, 20059312, 20063907, 20071212, 20080763, 20369185, 20402503, 20500249, 20616173, 20665720, 20674987, 20676965, 20695257, 20710810, 20738794, 20762543, 21460502, 21516759, 21518237, 21715808, 21726687, 21983513, 22050065, 22126870, 22193411, 22228119, 22233553, 22334792, 22452577, 22669248, 22673647, 22706487, 22722552, 22880597, 23495098, 23537874, 23540354, 23589288, 23669423, 23700167, 23704699, 23767544, 23798214, 24055640, 24333295, 24381379, 24660695, 24716502, 24767421, 24776782, 24819222, 24956764, 25020631, 25095195, 25144057, 25149276, 25280689, 25469409, 25549968, 25640779, 25769191, 25887780, 25941567, 25972961, 26008161, 26106773, 26218179, 26240260, 26288456, 26300820, 26546042, 26635531, 26702071, 26852418, 27113118, 27279513, 27335497, 27790424, 27800590, 27889390, 27898242, 28071313, 28314701, 28357786, 28418580, 28452161, 28682513, 28734830, 28867617, 29322935, 29348381, 29392781, 29581773, 29615918, 29644016, 29862931, 29894401, 30453434, 30570612, 30634148, 30659492, 30670136, 30673698, 30802487, 30956450, 31005138, 31018937, 31047659, 31070228, 31476112, 31543982, 31595572, 31874101, 31972653, 31990953, 32087599, 32157446, 32159639, 32199998, 32340790, 32381931, 32421926, 32438395, 32478740, 32507672, 32527784, 32724452, 32730481, 32743112, 32904311, 32918379, 32981665, 32982416, 33000591, 33042368, 33085294, 33085416, 33105940, 33486741, 33507766, 33619066, 33642660, 33698702, 33742756, 33795049, 33953512, 33964048, 34131735, 34211034, 34284308, 34386455, 34459252, 34514740, 34516340, 34516520, 34518724, 34651742, 34672505, 34757465, 35051386, 35157693, 35225557, 35316438, 35345979, 35418066, 35464722, 35514506, 35539598, 35595628, 35611943, 35786702, 35792479, 35878483, 35880471, 36028458, 36094578, 36179448, 36222697, 36249441, 36484357, 36503422, 36514252, 36757947, 37102189, 37122361, 37346658, 37551530, 37646972, 37702124, 38213383, 38286268, 38429729, 38504679, 38506115, 38799423, 38808091, 39052771, 39170226, 39338129, 39354314, 39393529, 39448716, 39780423, 39857281, 39916420, 39945223, 39964034, 40041806, 40101560, 40110897, 40206260, 40305582, 40388379, 40412752, 40512540, 40624969, 40651558, 40814460, 40924400, 40961935, 40994029, 41050739, 41082871, 41224568, 41242548, 41271745, 41290934, 41295777, 41559178, 41667098, 41704971, 41747983, 41873353, 41887284, 42023869, 42090468, 42228630, 42247258, 42383524, 42709380, 42836183, 42859399, 42992466, 42992694, 43206785, 43223032, 43232821, 43347440, 43435463, 43592061, 43598083, 43635663, 43840821, 43863638, 43877355, 43983225, 44043602, 44155812, 44286653, 44336729, 44369648, 44615929, 44882509, 44927506, 45162010, 45169496, 45386151, 45443129, 45450716, 45539092, 45576782, 45581006, 45903472, 45934903, 45976631, 46036782, 46042777, 46246310, 46426694, 46528196, 46629887, 46683079, 46701795, 46743963, 46806095, 46835954, 46851241, 46931472, 46967619, 47164649, 47328909, 47423713, 47428552, 47700544, 47774131, 47775873, 47812244, 47842565, 48079170, 48288532, 48500749, 48543891, 48552340, 48642346, 49011697, 49074567, 49087464, 49129084, 49427272, 49505446, 49658582, 49751181, 49769628, 49798035, 50192745, 50207573, 50246740, 50430344, 50432896, 50573069, 50643791, 50715357, 50872605, 51094609, 51231131, 51466432, 51501260, 51590051, 51596508, 51620597, 51737263, 52012071, 52057317, 52111334, 52236761, 52252252, 52466983, 52472355, 52486390, 52497908, 52644942, 52706892, 52754619, 52821858, 52870012, 53151967, 53461093, 53481683, 53482355, 53492767, 53508150, 53522937, 53744254, 53821140, 53973401, 54041834, 54077688, 54113144, 54303655, 54400706, 54487167, 54526064, 54706593, 54753490, 54769186, 54954367, 55137032, 55187741, 55633473, 55676882, 55757168, 55797330, 55850934, 55985034, 56096322, 56288314, 56305924, 56357386, 56363968, 56440772, 56497477, 56555665, 56628184, 56661724, 56716192, 56759596, 56798611, 56819115, 56845154, 56910557, 56917354, 57049111, 57058184, 57136778, 57146542, 57234446, 57274205, 57303779, 57419143, 57528559, 57727463, 57802568, 57815090, 57830249, 57921174, 57960803, 57963126, 57977567, 57996190, 58502726, 58703683, 58760085, 58808397, 58827246, 59015643, 59049037, 59060574, 59367745, 59623940, 59665435, 59964518, 59990263, 60148349, 60390592, 60455845, 60496214, 60632941, 60708888, 60751431, 60758354, 60794638, 60879882, 60924348, 60997884, 61131644, 61161956, 61287787, 61404648, 61427831, 61459008, 61761630, 62059693, 62207510, 62302558, 62471573, 62471933, 62533041, 62547986, 62594046, 62674527, 62879264, 63058601, 63099030, 63305597, 63310093, 63338855, 63422310, 63452774, 63475038, 63518449, 63540225, 63546175, 63590358, 63628825, 63791861, 63946207, 64022365, 64063721, 64111418, 64224934, 64310073, 64326137, 64754424, 64951153, 65098605, 65211642, 65326882, 65391053, 65417767, 65665284, 65785899, 65815235, 65881510, 65906689, 65944420, 66017540, 66072598, 66326304, 66450034, 66494370, 66618079, 66662249, 66770147, 66831739, 67067152, 67102330, 67246315, 67430611, 67516982, 67569942, 67778173, 67793425, 67908429, 68111229, 68182214, 68333559, 68341957, 68358466, 68671167, 68672279, 68835881, 68980144, 69029809, 69064871, 69228516, 69255531, 69256101, 69325352, 69509681, 69642438, 69818586, 69879300, 69920691, 69920697, 70160714, 70432807, 70472860, 70681656, 70682169, 70786473, 70901549, 70961940, 71030267, 71060026, 71094116, 71272148, 71342537, 71442061, 71945621, 72019889, 72089942, 72129857, 72170723, 72402322, 72456850, 72602370, 72667799, 72678332, 72793537, 72800952, 72920346, 73021425, 73078541, 73098983, 73179795, 73698539, 73705418, 73814520, 73929193, 73949505, 73959663, 73979267, 74060610, 74326634, 74356460, 74470210, 74522949, 75112250, 75136728, 75202236, 75231637, 75254382, 75261072, 75276857, 75402030, 75445420, 75690987, 75779834, 75800727, 75902124, 75997377, 76151605, 76452001, 76510171, 76591673, 76727700, 76787679, 76902418, 76932220, 76985395, 77086295, 77365527, 77416071, 77432542, 77441056, 77699618, 77975155, 78155126, 78515060, 78684869, 78768202, 78994031, 79095122, 79124324, 79535072, 79578201, 79643415, 79863661, 79889312, 79896183, 79922569, 79993598, 79997654, 80089310, 80173462, 80241596, 80422235, 80423532, 80424336, 80469797, 80679488, 80725060, 80813118, 80833294, 80855342, 80957024, 81080138, 81395692, 81492782, 81578259, 81647112, 81704994, 81801358, 81816930, 81839618, 81955089, 82135421, 82239561, 82403584, 82511319, 82609552, 82733675, 82899816, 82932782, 82938529, 82943458, 82994602, 83275981, 83387874, 83403474, 83469351, 83551462, 83835386, 84008372, 84317692, 84598042, 84673227, 84814738, 84923644, 85070612, 85353993, 85376423, 85384508, 85393966, 85617368, 85737723, 85782303, 85822710, 85858143, 86046471, 86133955, 86310680, 86314010, 86436286, 86459352, 86652109, 86701172, 86701188, 87190086, 87342047, 87420611, 87460915, 87621656, 87920848, 88089293, 88109470, 88584066, 88584441, 88592002, 88860733, 89044733, 89053151, 89109183, 89153648, 89186032, 89243331, 89463353, 89474847, 89620247, 89671673, 89930868, 90088353, 90097910, 90147956, 90192633, 90209102, 90285612, 90334433, 90339216, 90430268, 90480721, 90707358, 90881426, 91167987, 91222229, 91229448, 91324564, 91455014, 91614507, 91832779, 91941905, 91970452, 92076642, 92139614, 92168001, 92175901, 92356620, 92862195, 92935311, 93083411, 93116540, 93191858, 93226624, 93347264, 93598980, 93675259, 93912938, 93922115, 94057346, 94535330, 94662580, 94867822, 95093490, 95200469, 95435059, 95901617, 96011018, 96057122, 96181411, 96201265, 96313514, 96420822, 96586012, 96887826, 96923247, 97024311, 97052110, 97066334, 97073255, 97083022, 97095506, 97164918, 97375574, 97385231, 97573863, 97576060, 97648348, 97743933, 97752433, 97762577, 97870766, 98028383, 98123784, 98126355, 98431164, 98675832, 98723111, 98899277, 98906719, 98920733, 98940130, 99063985, 99145022, 99308431, 99348428, 99358087, 99471580, 99491829, 99599818, 99860842, 99952910, 99955376
.text
	li s0, 0x2000 # Load memory address offset
	
	# Load target value
	la t0, target
	lw s1, 0(t0)
		
	# Array size at t0
	la t0, arr_size
	lw t1, 0(t0)
	slli t1, t1, 2

	# Array initial address at s2 and final address at s3
	la s2, arr
	sub s2, s2, s0
	add s3, s2, t1
	
loop:
	# Assert array has minimum elements required
	blt s3, s2, fail
	addi s7, s7, 1
	
	# Find the middle element of sub array
	add t0, s2, s3
	srli t1, t0, 1
	
	# Load value to compare
	add t2, t1, s0
	jal ra, align
	lw t2, 0(t2)

	blt t2, s1, if_less
	bgt t2, s1, if_greater
	beq t2, s1, if_equal
	
	j end

if_less:
	addi s2, t1, 4
	j loop
if_greater:
	addi s3, t1, -4
	j loop
if_equal:
	la t3, arr
	sub t3, t3, s0
	sub t3, t1, t3
	srli s4, t3, 2	# Index of target located inside array
	add s5, t1, s0	# Absolute address of located target
	lw s6, 0(s5)	# Target value found
	j end
align:			# Must be optimized, maybe with "div/mod"...
	add t4, t1, zero
align2:	addi t4, t4, -4
	blt zero, t4, align2
	add t1, t1, t4 
	add t2, t2, t4 
	jr ra, 0
fail:
	li s4, -1
	j end
end:
